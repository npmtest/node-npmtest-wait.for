<html lang="en"><head>
    <title>Code coverage report for node-npmtest-wait.for/node_modules/wait.for/waitfor.js</title>
    <meta charset="utf-8">
    <style>
        body, html {
            margin:0; padding: 0;
        }
        body {
            font-family: Arial, Helvetica;
            font-size: 10pt;
        }
        div.header, div.footer {
            background: #eee;
            padding: 1em;
        }
        div.header {
            height: 160px;
            padding: 0 1em 0 1em;
            z-index: 100;
            position: fixed;
            top: 0;
            border-bottom: 1px solid #666;
            width: 100%;
        }
        div.footer {
            border-top: 1px solid #666;
        }
        div.body {
            margin-top: 170px;
        }
        div.meta {
            font-size: 90%;
            text-align: center;
        }
        h1, h2, h3 {
            font-weight: normal;
        }
        h1 {
            font-size: 12pt;
        }
        h2 {
            font-size: 10pt;
        }
        pre {
            font-family: Menlo, Monaco, Consolas, Courier New, monospace;
            margin: 0;
            padding: 0;
            font-size: 14px;
            tab-size: 2;
        }

        div.path { font-size: 110%; }
        div.path a:link, div.path a:visited { color: #000; }
        table.coverage { border-collapse: collapse; margin:0; padding: 0 }

        table.coverage td {
            margin: 0;
            padding: 0;
            color: #111;
            vertical-align: top;
        }
        table.coverage td.line-count {
            width: 50px;
            text-align: right;
            padding-right: 5px;
        }
        table.coverage td.line-coverage {
            color: #777 !important;
            text-align: right;
            border-left: 1px solid #666;
            border-right: 1px solid #666;
        }

        table.coverage td.text {
        }

        table.coverage td span.cline-any {
            display: inline-block;
            padding: 0 5px;
            width: 40px;
        }
        table.coverage td span.cline-neutral {
            background: #eee;
        }
        table.coverage td span.cline-yes {
            background: #b5d592;
            color: #999;
        }
        table.coverage td span.cline-no {
            background: #fc8c84;
        }

        .cstat-yes { color: #111; }
        .cstat-no { background: #fc8c84; color: #111; }
        .fstat-no { background: #ffc520; color: #111 !important; }
        .cbranch-no { background:  yellow !important; color: #111; }

        .cstat-skip { background: #ddd; color: #111; }
        .fstat-skip { background: #ddd; color: #111 !important; }
        .cbranch-skip { background: #ddd !important; color: #111; }

        .missing-if-branch {
            display: inline-block;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: black;
            color: yellow;
        }

        .skip-if-branch {
            display: none;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: #ccc;
            color: white;
        }

        .missing-if-branch .typ, .skip-if-branch .typ {
            color: inherit !important;
        }

        .entity, .metric { font-weight: bold; }
        .metric { display: inline-block; border: 1px solid #333; padding: 0.3em; background: white; }
        .metric small { font-size: 80%; font-weight: normal; color: #666; }

        div.coverage-summary table { border-collapse: collapse; margin: 3em; font-size: 110%; }
        div.coverage-summary td, div.coverage-summary table  th { margin: 0; padding: 0.25em 1em; border-top: 1px solid #666; border-bottom: 1px solid #666; }
        div.coverage-summary th { text-align: left; border: 1px solid #666; background: #eee; font-weight: normal; }
        div.coverage-summary th.file { border-right: none !important; }
        div.coverage-summary th.pic { border-left: none !important; text-align: right; }
        div.coverage-summary th.pct { border-right: none !important; }
        div.coverage-summary th.abs { border-left: none !important; text-align: right; }
        div.coverage-summary td.pct { text-align: right; border-left: 1px solid #666; }
        div.coverage-summary td.abs { text-align: right; font-size: 90%; color: #444; border-right: 1px solid #666; }
        div.coverage-summary td.file { text-align: right; border-left: 1px solid #666; white-space: nowrap;  }
        div.coverage-summary td.pic { min-width: 120px !important;  }
        div.coverage-summary a:link { color: #000; }
        div.coverage-summary a:visited { color: #333; }
        div.coverage-summary tfoot td { border-top: 1px solid #666; }

        div.coverage-summary .yui3-datatable-sort-indicator, div.coverage-summary .dummy-sort-indicator {
            height: 10px;
            width: 7px;
            display: inline-block;
            margin-left: 0.5em;
        }
        div.coverage-summary .yui3-datatable-sort-indicator {
            background: no-repeat scroll 0 0 transparent;
        }
        div.coverage-summary .yui3-datatable-sorted .yui3-datatable-sort-indicator {
            background-position: 0 -20px;
        }
        div.coverage-summary .yui3-datatable-sorted-desc .yui3-datatable-sort-indicator {
            background-position: 0 -10px;
        }

        .high { background: #b5d592 !important; }
        .medium { background: #ffe87c !important; }
        .low { background: #fc8c84 !important; }

        span.cover-fill, span.cover-empty {
            display:inline-block;
            border:1px solid #444;
            background: white;
            height: 12px;
        }
        span.cover-fill {
            background: #ccc;
            border-right: 1px solid #444;
        }
        span.cover-empty {
            background: white;
            border-left: none;
        }
        span.cover-full {
            border-right: none !important;
        }
        pre.prettyprint {
            border: none !important;
            padding: 0 !important;
            margin: 0 !important;
        }
        .com { color: #999 !important; }
        .ignore-none { color: #999; font-weight: normal; }

    </style>
</head>
<body>
<div class="header low">
    <h1 style="font-weight: bold;">
        <a href="https://github.com/npmtest/node-npmtest-wait.for">npmtest-wait.for (v0.0.1)</a>
    </h1>
    <h1>Code coverage report for <span class="entity">node-npmtest-wait.for/node_modules/wait.for/waitfor.js</span></h1>
    <h2>
        
        Statements: <span class="metric">13.16% <small>(10 / 76)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Branches: <span class="metric">0% <small>(0 / 26)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Functions: <span class="metric">0% <small>(0 / 13)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Lines: <span class="metric">15.15% <small>(10 / 66)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        Ignored: <span class="metric"><span class="ignore-none">none</span></span> &nbsp;&nbsp;&nbsp;&nbsp;
    </h2>
    <div class="path"><a href="../../../index.html">All files</a> » <a href="index.html">node-npmtest-wait.for/node_modules/wait.for/</a> » waitfor.js</div>
</div>
<div class="body">
<pre><table class="coverage">
<tbody><tr><td class="line-count">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224</td><td class="line-coverage"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">/* node wait.for
 - Sequential programming for node.js
 - Copyright 2013 Lucio Tato
*/
&nbsp;
"use strict";
var Fiber = require('fibers');
&nbsp;
var wait = {
&nbsp;
    launchFiber: <span class="fstat-no" title="function not covered">function(fn){</span> // wait.launchFiber(fn,arg1,arg2...)
&nbsp;
<span class="cstat-no" title="statement not covered">        if (typeof fn !== 'function') <span class="cstat-no" title="statement not covered">throw new Error('first argument must be a function');</span></span>
<span class="cstat-no" title="statement not covered">        var newargs=Array.prototype.slice.call(arguments,1); </span>// remove function from args
<span class="cstat-no" title="statement not covered">        Fiber( <span class="fstat-no" title="function not covered">function(){</span> <span class="cstat-no" title="statement not covered">fn.apply(null, newargs)}</span> ).run(); </span>//launch new fiber, call the fn with the args, this=null (strict)
    }
&nbsp;
    ,applyAndWait: <span class="fstat-no" title="function not covered">function(thisValue,fn,args){</span> // like js fn.apply, but wait for results
&nbsp;
<span class="cstat-no" title="statement not covered">        var fiber=Fiber.current;</span>
<span class="cstat-no" title="statement not covered">        if (!fiber) <span class="cstat-no" title="statement not covered">throw new Error('wait.for can only be called inside a fiber');</span></span>
&nbsp;
<span class="cstat-no" title="statement not covered">        var fnName = fn.name;</span>
&nbsp;
        //create a closure to resume on callback
<span class="cstat-no" title="statement not covered">        var resumeCallback=<span class="fstat-no" title="function not covered">function(err,data){</span></span>
<span class="cstat-no" title="statement not covered">                            if (fiber.callbackAlreadyCalled)</span>
<span class="cstat-no" title="statement not covered">                                 throw new Error("Callback for function "+fnName+" called twice. Wait.for already resumed the execution.");</span>
<span class="cstat-no" title="statement not covered">                            fiber.callbackAlreadyCalled = true;</span>
<span class="cstat-no" title="statement not covered">                            fiber.err=err; </span>//store err on fiber object
<span class="cstat-no" title="statement not covered">                            fiber.data=data; </span>//store data on fiber object
<span class="cstat-no" title="statement not covered">                            if (!fiber.yielded) {//when callback is called *before* async function returns</span>
                                // no need to "resume" because we never got the chance to "yield"
<span class="cstat-no" title="statement not covered">                                return;</span>
                            }
                            else {
                                //resume fiber after "yield"
<span class="cstat-no" title="statement not covered">                                fiber.run();   </span>
                            }
                        };
&nbsp;
<span class="cstat-no" title="statement not covered">        args.push(resumeCallback);/</span>/add resumeCallback to arguments
&nbsp;
<span class="cstat-no" title="statement not covered">        fiber.callbackAlreadyCalled=false;</span>
<span class="cstat-no" title="statement not covered">        fiber.yielded = false;</span>
<span class="cstat-no" title="statement not covered">        fn.apply(thisValue, args); </span>//call async function/method
<span class="cstat-no" title="statement not covered">        if (!fiber.callbackAlreadyCalled) { //except callback was called before async fn return</span>
<span class="cstat-no" title="statement not covered">            fiber.yielded = true;</span>
<span class="cstat-no" title="statement not covered">            Fiber.yield(); </span>//pause fiber, until callback =&gt; wait for results
        }
&nbsp;
<span class="cstat-no" title="statement not covered">        if (fiber.err) <span class="cstat-no" title="statement not covered">throw fiber.err; </span></span>//auto throw on error
<span class="cstat-no" title="statement not covered">        return fiber.data; </span>//return data on success
    }
&nbsp;
    ,for: <span class="fstat-no" title="function not covered">function(fn){</span> // wait.for(fn,arg1,arg2,...)
&nbsp;
<span class="cstat-no" title="statement not covered">        if (typeof fn !== 'function') <span class="cstat-no" title="statement not covered">throw new Error('wait.for: first argument must be an async function');</span></span>
&nbsp;
<span class="cstat-no" title="statement not covered">        var newargs=Array.prototype.slice.call(arguments,1); </span>// remove function from args
&nbsp;
<span class="cstat-no" title="statement not covered">        return wait.applyAndWait(null,fn,newargs); </span>
    }
&nbsp;
    ,forMethod: <span class="fstat-no" title="function not covered">function(obj,methodName){</span> // wait.forMethod(MyObj,'select',....)
&nbsp;
<span class="cstat-no" title="statement not covered">        var method=obj[methodName];</span>
<span class="cstat-no" title="statement not covered">        if (!method) <span class="cstat-no" title="statement not covered">throw new Error('wait.forMethod: second argument must be the async method name (string)');</span></span>
        
<span class="cstat-no" title="statement not covered">        var newargs=Array.prototype.slice.call(arguments,2); </span>// remove obj and method name from args
<span class="cstat-no" title="statement not covered">        return wait.applyAndWait(obj,method,newargs);</span>
    }
&nbsp;
};
&nbsp;
//parallel extensions
/*
Main Functions:
&nbsp;
wait.parallel.launch = function(functions)
----------------------
     
     Note: must be in a Fiber
    
     input: 
        functions: Array = [func,arg,arg],[func,arg,arg],...
        
        it launch a fiber for each func
        the fiber do: resultArray[index] = func.apply(undefined,args)
        
     returns array with a result for each function
     do not "returns" until all fibers complete
&nbsp;
     throws if error
&nbsp;
&nbsp;
wait.parallel.map = function(arr,mappedFn)
----------------------
     
     Note: must be in a Fiber
    
     input: 
        arr: Array
        mappedFn = function(item,index,arr) 
        
            mappedFn should return converted item. Since we're in a fiber
            mappedFn can use wait.for and also throw/try/catch
        
&nbsp;
     returns array with converted items
     do not "returns" until all fibers complete
&nbsp;
     throws if error
&nbsp;
&nbsp;
wait.parallel.filter = function(arr, itemTestFn)
----------------------
&nbsp;
     Note: must be in a Fiber
    
     input: 
        arr: Array
        itemTestFn = function(item,index,arr) 
        
            itemTestFn should return true|false. Since we're in a fiber
            itemTestFn can use wait.for and also throw/try/catch
        
     returns array with items where itemTestFn() returned true
     do not "returns" until all fibers complete
&nbsp;
     throws if error
&nbsp;
*/
&nbsp;
&nbsp;
wait.parallel = {};
&nbsp;
wait.parallel.taskJoiner=<span class="fstat-no" title="function not covered">function(inx,context,err,data){</span>
    
<span class="cstat-no" title="statement not covered">        if (context.finished) <span class="cstat-no" title="statement not covered">return;</span></span>
&nbsp;
<span class="cstat-no" title="statement not covered">        context.count++;</span>
        //console.log('arrived result',inx,err,data,"result.count",context.count,"task",context.taskId);
    
<span class="cstat-no" title="statement not covered">        if (err) {</span>
<span class="cstat-no" title="statement not covered">            context.finished = true;</span>
<span class="cstat-no" title="statement not covered">            return context.finalCallback(err); </span>//err in one of the fibers
        }
        else 
<span class="cstat-no" title="statement not covered">            context.results[inx]=data;</span>
&nbsp;
<span class="cstat-no" title="statement not covered">        if (context.count&gt;=context.expected) { // all contexts arrived</span>
            //console.log("finall callback. elements:",context.count);
<span class="cstat-no" title="statement not covered">            context.finished = true;</span>
<span class="cstat-no" title="statement not covered">            return context.finalCallback(null,context.results) ; </span>// final callback
        }
};
&nbsp;
wait.parallel.fiberForItemBody = <span class="fstat-no" title="function not covered">function(inx,context,functionAndArgs){</span>
    //console.log('fiber',inx,'calling mappedFunction',args);
<span class="cstat-no" title="statement not covered">    try{</span>
<span class="cstat-no" title="statement not covered">        var data = functionAndArgs[0].apply(undefined,functionAndArgs.slice(1));</span>
<span class="cstat-no" title="statement not covered">        wait.parallel.taskJoiner(inx,context,null,data);</span>
    }
    catch(err){
<span class="cstat-no" title="statement not covered">        wait.parallel.taskJoiner(inx,context,err);</span>
    }
};
&nbsp;
&nbsp;
wait.parallel.async_launch = <span class="fstat-no" title="function not covered">function(functions,finalCallback){</span>
    //
    // functions:Array = [function,arg,arg..],[function,arg,arg,...],...
    // call finalCallback array with results of each func, a fiber is launched for each item
    // finalCallback is called when all functions complete
    //
<span class="cstat-no" title="statement not covered">    var context={results:[],count:0, expected:functions.length, finished:false, finalCallback:finalCallback};</span>
<span class="cstat-no" title="statement not covered">    if (context.expected===0) <span class="cstat-no" title="statement not covered">return finalCallback(null,context.results);</span></span>
&nbsp;
    //launch a fiber for each item, 
    // each item is an array containing function ptr and arguments
<span class="cstat-no" title="statement not covered">    for (var i = 0; i &lt; functions.length; i++) {</span>
<span class="cstat-no" title="statement not covered">        wait.launchFiber(wait.parallel.fiberForItemBody,i,context,functions[i]);</span>
    };
};
&nbsp;
wait.parallel.launch = <span class="fstat-no" title="function not covered">function(functions){</span>
    //
    // functions = [function,arg,arg],[function,arg,arg],...
    // returns array with results of each func, a fiber is launched for each item
    // wait.parallel.returns when all functions complete
    //
<span class="cstat-no" title="statement not covered">    return wait.for(wait.parallel.async_launch, functions);</span>
};
&nbsp;
wait.parallel.map = <span class="fstat-no" title="function not covered">function(arr,mappedFn){</span>
    // must be in a Fiber
    //
    // mappedFn = function(item,index,arr) returns converted item, a fiber is launched for each item
    //
    // convert arr into an array of functions + parameters
<span class="cstat-no" title="statement not covered">    var functions = arr.map(<span class="fstat-no" title="function not covered">function(item,inx){<span class="cstat-no" title="statement not covered"></span>return [mappedFn,item,inx,arr]}</span>);</span>
    // launch a fiber for each item. wait until all fibers complete
<span class="cstat-no" title="statement not covered">    return wait.parallel.launch(functions);</span>
}
&nbsp;
wait.parallel.filter = <span class="fstat-no" title="function not covered">function(arr,itemTestFn){</span>
    // must be in a Fiber
    //
    // mappedFn = function(item,index,arr) returns true/false
    //
<span class="cstat-no" title="statement not covered">    var testResults = wait.parallel.map(arr,itemTestFn);</span>
&nbsp;
    // create an array for each item where itemTestFn returned true
<span class="cstat-no" title="statement not covered">    var filteredArr=[];</span>
<span class="cstat-no" title="statement not covered">    for (var i = 0; i &lt; arr.length; i++) </span>
<span class="cstat-no" title="statement not covered">        if (testResults[i]) <span class="cstat-no" title="statement not covered">filteredArr.push(arr[i]);</span></span>
&nbsp;
<span class="cstat-no" title="statement not covered">    return filteredArr;</span>
}
&nbsp;
module.exports = wait; //export
&nbsp;
&nbsp;</pre></td></tr>
</tbody></table></pre>
</div>
<div class="footer">
    <div class="meta">Generated by <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a> at Fri Apr 21 2017 08:18:12 GMT+0000 (UTC)</div>
</div>


</body></html>